<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting started • cppSim</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting started">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cppSim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting_started_2.html">Getting started</a></li>
    <li><a class="dropdown-item" href="../articles/gravity_model.html">Gravity model</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ischlo/cppSim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Getting started</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ischlo/cppSim/blob/main/vignettes/getting_started_2.Rmd" class="external-link"><code>vignettes/getting_started_2.Rmd</code></a></small>
      <div class="d-none name"><code>getting_started_2.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>cppSim</code> package was developed in order to have the
possibility to do spatial interaction models at scale on a regular spec
machine. The few existing packages proposing similar functionality tend
to prioritize the different functionalities, and end up being suited for
small models, say a few dozen origins and destinations. But what if you
want to analyse a whole city, region, or even country with potentially
hundreds or thousands of ODs ? This is where <code>cppSim</code> steps
in. This vignette will present a typical set up one might have when
doing SIMs. And to keep it simple, we will focus only on the modelling
part. This means we will cover the steps of getting data, building a
network, routing in another, longer article. We will use the data sets
that come with this package to demonstrate power of
<code>cppSim</code>.</p>
</div>
<div class="section level2">
<h2 id="set-up">Set up<a class="anchor" aria-label="anchor" href="#set-up"></a>
</h2>
<p>Let’s install and import the library and the data sets.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># remotes::install_github('ischlo/cppSim')</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ischlo.github.io/cppSim/" class="external-link">cppSim</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; OpenMP detected, parallel computations will be performed.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"distance_test"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"flows_test"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"london_msoa"</span><span class="op">)</span></span></code></pre></div>
<p>The two data sets provided consist in the flow matrix
<code>flows_test</code> with cycling and walking flows combined between
every MSOA in Greater London. The data was obtained from the 2011 UK
census open data portal. The second matrix is a distance matrix between
the centroids of every MSOAs in Greater London. It was computed using
the great <a href="https://github.com/vlarmet/cppRouting" class="external-link"><code>cppRouting</code></a>
package and OpenStreetMap networks adapted to be suitable for cycling
and walking. The networks can be downloaded in a good format with the
python package <code>OSMnx</code>, or with the recently published, but
yet under development <a href="https://ischlo.github.io/cppRosm/" class="external-link"><code>cppRosm</code></a>
package in R</p>
<p>Let’s have a look at the size of these:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">distance_test</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 983 983</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">flows_test</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 983 983</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Warning in xy.coords(x, y, xlabel, ylabel, log): 1 x value &lt;= 0 omitted from</span></span>
<span><span class="co">#&gt; logarithmic plot</span></span></code></pre>
<p><img src="getting_started_2_files/figure-html/unnamed-chunk-3-1.png" width="45%"><img src="getting_started_2_files/figure-html/unnamed-chunk-3-2.png" width="45%"></p>
</div>
<div class="section level2">
<h2 id="visualisation">Visualisation<a class="anchor" aria-label="anchor" href="#visualisation"></a>
</h2>
</div>
<div class="section level2">
<h2 id="model">Model<a class="anchor" aria-label="anchor" href="#model"></a>
</h2>
<p>If the coefficient of the distance decay (cost) function is known,
one can simply run:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">.1</span></span>
<span></span>
<span><span class="va">res_model</span> <span class="op">&lt;-</span> <span class="fu">cppSim</span><span class="fu">::</span><span class="fu"><a href="../reference/run_model.html">run_model</a></span><span class="op">(</span></span>
<span>  flows <span class="op">=</span> <span class="va">flows_test</span>,</span>
<span>  distance <span class="op">=</span> <span class="va">distance_test</span>,</span>
<span>  beta <span class="op">=</span> <span class="va">beta</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">res_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ values: num [1:983, 1:983] 283.6 5.6 14.3 10.8 12.7 ...</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">res_model</span><span class="op">$</span><span class="va">values</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 983 983</span></span></code></pre></div>
<p>Let’s have a look at the correlation between the model output and
data:</p>
<p><img src="getting_started_2_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">res_model</span><span class="op">$</span><span class="va">values</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">flows_test</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.5903494</span></span></code></pre></div>
<p>the correlation is already high, but we can do better, for that, we
will need to calibrate the model. This is done with the
<code>simulation</code> function, it will find the optimal cost function
that gives the best fit.</p>
<div class="section level3">
<h3 id="simulation">Simulation<a class="anchor" aria-label="anchor" href="#simulation"></a>
</h3>
<p>If you want to run a full simulation that will calibrate a model and
determine the optimal distance decay coefficient, do the following:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">res_sim</span> <span class="op">&lt;-</span> <span class="fu">cppSim</span><span class="fu">::</span><span class="fu"><a href="../reference/simulation.html">simulation</a></span><span class="op">(</span></span>
<span>  flows_matrix <span class="op">=</span> <span class="va">flows_test</span>,</span>
<span>  dist_matrix <span class="op">=</span> <span class="va">distance_test</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">res_sim</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ best_fit_values: num [1:983, 1:983] 1.43e+03 2.87e-03 9.48e-03 8.72e-04 8.05e-03 ...</span></span>
<span><span class="co">#&gt;  $ best_fit_beta  : num 0.962</span></span>
<span></span>
<span><span class="va">res_sim</span><span class="op">$</span><span class="va">best_fit_beta</span></span>
<span><span class="co">#&gt; [1] 0.9615716</span></span></code></pre></div>
<p>The output will be a list with two elements, first the output of a
model run that best fits the observed data. Second, the optimal distance
decay exponent that produces this result. This value will be relevant
for further modelling. Let’s see some of the model results:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_sim</span><span class="op">$</span><span class="va">best_fit_values</span>,</span>
<span>  <span class="va">flows_test</span></span>
<span>  <span class="co"># ,log = 'xy'</span></span>
<span>  ,</span>
<span>  main <span class="op">=</span> <span class="st">"Model vs Data"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="getting_started_2_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Let’s see how the model output correlates with the observed data:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">res_sim</span><span class="op">$</span><span class="va">best_fit_values</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">flows_test</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9287456</span></span></code></pre></div>
<!-- # Conclusion -->
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ivann Schlosser.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
